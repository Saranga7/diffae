/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:446: UserWarning: Checkpoint directory checkpoints/ffhq128_autoenc_130M_part2 exists and is not empty.
  rank_zero_warn(f"Checkpoint directory {dirpath} exists and is not empty.")
/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:432: UserWarning: ModelCheckpoint(save_last=True, save_top_k=None, monitor=None) is a redundant configuration. You can save the last checkpoint with ModelCheckpoint(save_top_k=None, monitor=None).
  rank_zero_warn(
Using native 16bit precision.
GPU available: True, used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
Global seed set to 0
Using cache found in /users/biocomp/mahanta/.cache/torch/hub/pytorch_vision_v0.10.0
Global seed set to 0
initializing ddp: GLOBAL_RANK: 0, MEMBER: 1/2
Using native 16bit precision.
Global seed set to 0
Using cache found in /users/biocomp/mahanta/.cache/torch/hub/pytorch_vision_v0.10.0
Global seed set to 0
initializing ddp: GLOBAL_RANK: 1, MEMBER: 2/2
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All DDP processes registered. Starting ddp with 2 processes
----------------------------------------------------------------------------------------------------

LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]

  | Name      | Type                 | Params
---------------------------------------------------
0 | model     | BeatGANsAutoencModel | 131 M 
1 | ema_model | BeatGANsAutoencModel | 131 M 
---------------------------------------------------
128 M     Trainable params
133 M     Non-trainable params
262 M     Total params
1,048.290 Total estimated model params size (MB)
/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/callbacks/lr_monitor.py:112: RuntimeWarning: You are using `LearningRateMonitor` callback with models that have no learning rate schedulers. Please see documentation for `configure_optimizers` method.
  rank_zero_warn(
conf: ffhq128_autoenc_130M_part2
ckpt path: checkpoints/ffhq128_autoenc_130M_part2/last.ckpt
Model params: 124.97 M
local seed: 0
train data: 70001
val data: 70001
on train dataloader start ...
Training: -1it [00:00, ?it/s]Training:   0%|          | 0/4375 [00:00<00:00, 16644.06it/s]Epoch 0:   0%|          | 0/4375 [00:00<00:01, 2421.65it/s]  conf: ffhq128_autoenc_130M_part2
ckpt path: checkpoints/ffhq128_autoenc_130M_part2/last.ckpt
Model params: 124.97 M
local seed: 1
train data: 70001
val data: 70001
on train dataloader start ...
/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
Epoch 0:   0%|          | 1/4375 [00:02<1:28:25,  1.21s/it]Epoch 0:   0%|          | 1/4375 [00:02<1:28:27,  1.21s/it, loss=1, v_num=]


You were right 






Workflow reached to None conditioning



[rank1]: Traceback (most recent call last):
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/run_ffhq128.py", line 13, in <module>
[rank1]:     train(conf, gpus=gpus)
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 1010, in train
[rank1]:     trainer.fit(model)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 552, in fit
[rank1]:     self._run(model)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 917, in _run
[rank1]:     self._dispatch()
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 985, in _dispatch
[rank1]:     self.accelerator.start_training(self)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/accelerators/accelerator.py", line 92, in start_training
[rank1]:     self.training_type_plugin.start_training(trainer)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 161, in start_training
[rank1]:     self._results = trainer.run_stage()
[rank1]:                     ^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 995, in run_stage
[rank1]:     return self._run_train()
[rank1]:            ^^^^^^^^^^^^^^^^^
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 1044, in _run_train
[rank1]:     self.fit_loop.run()
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/base.py", line 111, in run
[rank1]:     self.advance(*args, **kwargs)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/fit_loop.py", line 200, in advance
[rank1]:     epoch_output = self.epoch_loop.run(train_dataloader)
[rank1]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/base.py", line 111, in run
[rank1]:     self.advance(*args, **kwargs)
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/epoch/training_epoch_loop.py", line 149, in advance
[rank1]:     self.trainer.call_hook(
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 1226, in call_hook
[rank1]:     output = hook_fx(*args, **kwargs)
[rank1]:              ^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 492, in on_train_batch_end
[rank1]:     self.log_sample(x_start=imgs)
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 623, in log_sample
[rank1]:     do(self.model, '', use_xstart=True, save_real=True)
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 562, in do
[rank1]:     gen = self.eval_sampler.sample(model=model,
[rank1]:           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 210, in sample
[rank1]:     return self.ddim_sample_loop(model,
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 737, in ddim_sample_loop
[rank1]:     for sample in self.ddim_sample_loop_progressive(
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 797, in ddim_sample_loop_progressive
[rank1]:     out = self.ddim_sample(
[rank1]:           ^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 602, in ddim_sample
[rank1]:     out = self.p_mean_variance(
[rank1]:           ^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/diffusion.py", line 96, in p_mean_variance
[rank1]:     return super().p_mean_variance(self._wrap_model(model), *args,
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 309, in p_mean_variance
[rank1]:     model_forward = model.forward(x=x,
[rank1]:                     ^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/diffusion.py", line 153, in forward
[rank1]:     return self.model(x=x, t=do(t), t_cond=t_cond, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank1]:     return self._call_impl(*args, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank1]:     return forward_call(*args, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/import/pr_deepdevpath2/Saranga/diffae/model/unet_autoenc.py", line 181, in forward
[rank1]:     assert len(x) == len(x_start), f'{len(x)} != {len(x_start)}'
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank1]: AssertionError: 16 != 8



You were right 






Workflow reached to None conditioning



[rank0]: Traceback (most recent call last):
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/run_ffhq128.py", line 13, in <module>
[rank0]:     train(conf, gpus=gpus)
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 1010, in train
[rank0]:     trainer.fit(model)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 552, in fit
[rank0]:     self._run(model)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 917, in _run
[rank0]:     self._dispatch()
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 985, in _dispatch
[rank0]:     self.accelerator.start_training(self)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/accelerators/accelerator.py", line 92, in start_training
[rank0]:     self.training_type_plugin.start_training(trainer)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 161, in start_training
[rank0]:     self._results = trainer.run_stage()
[rank0]:                     ^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 995, in run_stage
[rank0]:     return self._run_train()
[rank0]:            ^^^^^^^^^^^^^^^^^
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 1044, in _run_train
[rank0]:     self.fit_loop.run()
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/base.py", line 111, in run
[rank0]:     self.advance(*args, **kwargs)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/fit_loop.py", line 200, in advance
[rank0]:     epoch_output = self.epoch_loop.run(train_dataloader)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/base.py", line 111, in run
[rank0]:     self.advance(*args, **kwargs)
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/loops/epoch/training_epoch_loop.py", line 149, in advance
[rank0]:     self.trainer.call_hook(
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/pytorch_lightning/trainer/trainer.py", line 1226, in call_hook
[rank0]:     output = hook_fx(*args, **kwargs)
[rank0]:              ^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 492, in on_train_batch_end
[rank0]:     self.log_sample(x_start=imgs)
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 623, in log_sample
[rank0]:     do(self.model, '', use_xstart=True, save_real=True)
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/experiment.py", line 562, in do
[rank0]:     gen = self.eval_sampler.sample(model=model,
[rank0]:           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 210, in sample
[rank0]:     return self.ddim_sample_loop(model,
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 737, in ddim_sample_loop
[rank0]:     for sample in self.ddim_sample_loop_progressive(
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 797, in ddim_sample_loop_progressive
[rank0]:     out = self.ddim_sample(
[rank0]:           ^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 602, in ddim_sample
[rank0]:     out = self.p_mean_variance(
[rank0]:           ^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/diffusion.py", line 96, in p_mean_variance
[rank0]:     return super().p_mean_variance(self._wrap_model(model), *args,
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/base.py", line 309, in p_mean_variance
[rank0]:     model_forward = model.forward(x=x,
[rank0]:                     ^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/diffusion/diffusion.py", line 153, in forward
[rank0]:     return self.model(x=x, t=do(t), t_cond=t_cond, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/users/biocomp/mahanta/anaconda3/envs/diffae/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/import/pr_deepdevpath2/Saranga/diffae/model/unet_autoenc.py", line 181, in forward
[rank0]:     assert len(x) == len(x_start), f'{len(x)} != {len(x_start)}'
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank0]: AssertionError: 16 != 8
Epoch 0:   0%|          | 1/4375 [00:05<3:38:38,  3.00s/it, loss=1, v_num=]